<!-- views/characters/edit.ejs -->
<div class="d-flex justify-between align-center mb-4">
  <h1>Edit Character: <%= character.name %></h1>
  <div>
    <a href="/characters/<%= character.id %>" class="btn btn-outline mr-2">
      <i class="fas fa-eye"></i> View Character
    </a>
    <a href="/characters/my-characters" class="btn btn-outline">
      <i class="fas fa-arrow-left"></i> Back to My Characters
    </a>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <form action="/characters/edit/<%= character.id %>?_method=PUT" method="POST">
      
      <div class="row">
        <!-- Basic Information Column -->
        <div class="col" style="flex: 0 0 70%;">
          <%- include('./partials/basic-info', { character }) %>
        </div>
        
        <!-- Avatar and Settings Column -->
        <div class="col" style="flex: 0 0 30%;">
          <%- include('./partials/avatar-settings', { character }) %>
        </div>
      </div>
      
      <hr style="border-color: rgba(255, 255, 255, 0.1); margin: 30px 0;">
      
      <!-- Character Details Tabs -->
      <%- include('./partials/details-tabs', { character }) %>
      
      <div class="form-group text-right">
        <a href="/characters/my-characters" class="btn btn-outline mr-2">Cancel</a>
        <button type="submit" class="btn">Save Changes</button>
      </div>
    </form>
  </div>
  <script>
    // Run this after the page is fully loaded
    window.addEventListener('load', function() {
      console.log('Emergency tab fix running');
      
      // Make all tabs visible
      const tabPanes = document.querySelectorAll('.character-tab-pane');
      console.log('Found tab panes:', tabPanes.length);
      
      // If we found tab panes, make them visible
      if (tabPanes.length > 0) {
        tabPanes.forEach(function(pane) {
          pane.style.display = 'block';
        });
        
        // Make the first one active
        tabPanes[0].classList.add('active');
        
        // Make the corresponding tab link active
        const firstTabLink = document.querySelector('.character-tab-link');
        if (firstTabLink) {
          firstTabLink.classList.add('active');
        }
      } else {
        // If no tab panes found, try direct ID approach
        ['tab-personality', 'tab-appearance', 'tab-background', 'tab-details'].forEach(function(id) {
          const tab = document.getElementById(id);
          if (tab) {
            tab.style.display = 'block';
          }
        });
      }
    });
  </script>
</div>

<!-- JavaScript for tab functionality and image preview -->
<%- include('./partials/character-form-scripts') %>